<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Welcome</title>
   <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f4f4f4; /* Background color */
        background-image: url('your-image-url.jpg'); /* Background image */
        background-size: cover;
        background-position: center;
        height: 100vh; /* Set the background to cover the entire viewport */
      }
  
      h1 {
        color: #333;
      }
  
      /* Styles for the search box */
      #searchBox {
        margin-top: 20px;
        padding: 8px;
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
  
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        background-color: #fff; /* Table background color */
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
  
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
  
      th {
        background-color: #f2f2f2;
      }
    </style>
</head>
<body>
    <h1>Welcome</h1>

    <form action="/search" method="GET">
        <input type="text" name="query" placeholder="Enter product name">
        <button onclick="searchProduct()">Search</button>
    </form>

    <button onclick="getData()">Get Data</button>
    <button onclick="logout()">Logout</button>

    <table id="data-table" border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Price</th>
                <!-- Add more table headers if needed -->
            </tr>
        </thead>        
    </table>

    <script>


function searchProduct() {
    
// Get access token from localStorage
const accessTokenSaved  = localStorage.getItem('access_token'); 
if(!accessTokenSaved) {


    const urlParams = new URLSearchParams(window.location.search);
    const code = urlParams.get('code');
    // Call Azure Function to exchange code for access token
        fetch('https://converttotoken.azurewebsites.net/api/HttpTrigger1?code=XEB0J6TckAAV88B9ybY_nvD6zxbY3--vSy3YqZTupSefAzFulfoMXg==&authCode=' + code)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                localStorage.setItem('access_token',data.access_token)
                // You can now use the obtained access token as needed
            })
            .then (() => {
                // Fetch function 2 after function 1 completes
                return fetchData();
            })
            .catch(error => console.error(error));

        }
 else {
    fetchData();
 }       

}



function getData() {

    
    // Get access token from localStorage
    const accessTokenSaved  = localStorage.getItem('access_token'); 
    if(!accessTokenSaved) {

    
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        // Call Azure Function to exchange code for access token
            fetch('https://converttotoken.azurewebsites.net/api/HttpTrigger1?code=XEB0J6TckAAV88B9ybY_nvD6zxbY3--vSy3YqZTupSefAzFulfoMXg==&authCode=' + code)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    localStorage.setItem('access_token',data.access_token)
                    // You can now use the obtained access token as needed
                })
                .then (() => {
                    // Fetch function 2 after function 1 completes
                    return fetchData();
                })
                .catch(error => console.error(error));

            }
     else {
        fetchData();
     }       

}

function fetchData() {

    // Get access token from localStorage
    const accessToken = localStorage.getItem('access_token'); // Assuming you've stored the access token in localStorage

    // Make sure access token is available
    if (!accessToken) {
        console.error('Access token not found');
        return;
    }

    // Construct headers with Authorization header containing the access token
    const headers = new Headers();
    headers.append('user-token', `${accessToken}`);

    // Make API call to Azure Kubernetes Service with the access token in the header
    // Make API call to Azure Kubernetes Service with the access token in the header
    fetch('http://4.157.0.172', {
        headers: headers
    })
    .then(response => {
        if (!response.ok) {
        throw new Error('Network response was not ok');
    }
        return response.json();
    })
    .then(data => {
        // Display data in a table
        const dataTable = document.getElementById('data-table');
        // Clear previous content
        dataTable.innerHTML = '';
        // Assuming data is an array of objects with properties to display
        data.forEach(item => {
        const row = dataTable.insertRow();
        row.insertCell(0).textContent = item.id;
        row.insertCell(1).textContent = item.name;
        // Add more cells for additional properties
        });
    })
    .catch(error => console.error('Error fetching data:', error));


}
        

        function logout() {
            // Redirect to logout URL
            window.location.href = 'LOGOUT_URL';
        }
    </script>
</body>
</html>
